{% extends "_base_page.html" %}

{% block page_title %}Your response to ‘{{ brief.title }}’ - Digital Marketplace{% endblock %}

{% block main_content %}

{% with messages = get_flashed_messages(with_categories=True) %}
  {% for category, message in messages %}
    {%
    with
    message = {
      "already_applied": "You’ve already applied for ‘{}’ so you can’t apply again".format(brief.title) if result_state == "submitted_ok"
                    else "You already applied for ‘{}’ but you didn’t meet the essential requirements".format(brief.title)
    }[message] or message,
    type = "destructive" if category == "error" else "success"
    %}
      {% include "toolkit/notification-banner.html" %}
    {% endwith %}
  {% endfor %}
{% endwith %}

<div class="grid-row">
  <div class="column-two-thirds">
    {% with
      heading = {
                  "submitted_ok": "Your response to ‘{}’ has been submitted".format(brief.title),
                  "submitted_unsuccessful": "You don’t meet all the essential requirements"
                }[result_state],
      smaller = true
      %}
        {% include 'toolkit/page-heading.html' %}
    {% endwith %}

    <div class="dmspeak">

    {% if result_state == "submitted_ok" %}
    <ol class="list-number">
      <li>
        <div class="explanation-list">
          <p class="lead"> When the opportunity closes, the buyer will create a shortlist. They can exclude you if:</p>
          <ul class="list-bullet">
            <li>you can’t start when they need you to</li>
            <li>you have fewer nice‑to‑have skills and experience than qualifying suppliers</li>
            {% if brief.lot == "digital-specialists" and brief.get('budgetRange') %}
            <li>your day rate exceeds their budget</li>
            {% endif %}
          </ul>
        </div>
      </li>
    </ol>

    {% elif result_state == "submitted_unsuccessful" %}
      <p>
        You don’t have all the essential skills and experience so the buyer can’t add you to their shortlist.
      </p>
    {% endif %}
    </div>
  </div>
</div>

<div class="grid-row">
  <div class="column-one-whole">
    {% include 'briefs/_brief_response_data.html' %}
  </div>
</div>

  {%
    with
      url = url_for(".dashboard"),
      text = "Your account"
  %}
    {% include "toolkit/secondary-action-link.html" %}
  {% endwith %}

  {% endblock %}
